# 修复验证测试指南

## 已修复的问题

### 1. ✅ 图表横坐标不随选项卡变动的问题
**修复内容：**
- 更新了 `useEffect` 监听逻辑，现在会根据选项卡切换更新 x 轴数据
- 添加了 `organizePriceDataByTimeframe` 函数来正确组织不同时间范围的数据
- 修复了图表更新时的 x 轴数据和图例显示

**测试步骤：**
1. 运行项目：`npm run dev`
2. 输入商品ID（如 SKU001）和日期
3. 点击查询按钮
4. 在价格走势图上方切换选项卡：
   - 点击"综合视图" - 应显示所有数据的完整时间轴
   - 点击"近期数据" - 应只显示近90天的时间轴
   - 点击"同期对比" - 应只显示去年同期的时间轴
5. 验证横坐标确实随选项卡变化

### 2. ✅ 添加了预测标签vs真实标签对比曲线图
**新增功能：**
- 创建了 `createPredictionLabelComparisonChart` 函数
- 添加了专门的标签对比图表容器
- 实现了时间序列的预测vs真实标签可视化

**测试步骤：**
1. 查询有对比数据的商品预测
2. 滚动到页面下方，应该看到新的图表：
   - "预测标签vs真实标签对比曲线"
   - 图表显示 1=变动，0=不变 的时间序列
   - 绿色圆点表示预测正确，红色圆点表示预测错误
   - 鼠标悬停可查看详细信息

### 3. ✅ 增强了准确率统计显示
**改进内容：**
- 添加了详细的准确率统计卡片
- 显示整体准确率、最高准确率、最低准确率
- 包含商品ID信息

**测试步骤：**
1. 查询预测数据
2. 查看"预测结果统计"部分
3. 验证显示了详细的准确率信息

## 测试用例

### 测试用例1：基本功能测试
```
商品ID: SKU001
预测日期: 2025-08-19
预测步长: 7日
概率阈值: 0.6

预期结果：
- 显示价格走势图
- 显示每日预测概率图
- 显示预测vs真实对比图
- 显示预测标签vs真实标签对比曲线图
- 显示详细准确率统计
```

### 测试用例2：选项卡切换测试
```
操作步骤：
1. 完成基本查询
2. 点击"近期数据"选项卡
3. 点击"同期对比"选项卡
4. 点击"综合视图"选项卡

预期结果：
- 每次切换时横坐标应该改变
- 图例选中状态应该改变
- 数据显示范围应该改变
```

### 测试用例3：数据验证测试
```
验证项目：
- 预测概率是否在0-1之间
- 日期格式是否正确
- 准确率计算是否正确
- 图表交互是否正常
```

## 已知限制

1. **示例数据模式**：当前使用生成的示例数据，真实数据需要配置 Supabase
2. **性能优化**：大量数据时可能需要分页或虚拟滚动
3. **移动端适配**：图表在小屏幕上可能需要进一步优化

## 下一步改进建议

1. **数据源切换**：
   - 实现真实数据和示例数据的无缝切换
   - 添加数据源指示器

2. **交互增强**：
   - 添加图表联动功能
   - 实现数据导出功能

3. **性能优化**：
   - 实现数据懒加载
   - 添加缓存机制

4. **用户体验**：
   - 添加加载状态指示
   - 优化错误处理和提示

## 故障排除

### 如果图表不显示：
1. 检查浏览器控制台是否有错误
2. 确认 ECharts 库已正确加载
3. 验证数据格式是否正确

### 如果选项卡切换无效：
1. 检查 `priceViewMode` 状态是否正确更新
2. 确认 `useEffect` 依赖项是否正确
3. 验证图表实例是否存在

### 如果准确率显示异常：
1. 检查对比数据是否包含有效的 `isCorrect` 字段
2. 验证 `calculateAccuracyStats` 函数逻辑
3. 确认数据过滤条件是否正确